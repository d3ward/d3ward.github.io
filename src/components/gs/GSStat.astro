---
import Icon from "../common/Icon.astro";

// Area to Icon mapping - automatic icon assignment based on area
const AREA_ICON_MAP = {
  logo: null,
  gh: "tabler:brand-github",
  stars: "tabler:star",
  followers: "tabler:users-group",
  commits: "tabler:git-commit",
  issues: "tabler:circle-dot",
  link: "tabler:external-link",
  pr: "tabler:git-pull-request",
  repos: "tabler:book-2",
} as const;

// Area to Tailwind classes mapping
// Uses blue-* scale from tailwind.config.js to match the old --primary-h/l/d pattern
const AREA_CLASSES = {
  logo: "bg-white text-blue-500 border-4 border-blue-500 aspect-square",
  stars: "bg-blue-50 text-blue-500 aspect-square",
  followers: "bg-blue-50 text-blue-500",
  commits: "bg-blue-50 text-blue-500 aspect-square",
  issues: "bg-blue-500 text-white aspect-square",
  gh: "bg-white text-blue-500",
  pr: "bg-blue-400 text-white",
  repos: "bg-blue-400 text-white",
} as const;

type AreaType = keyof typeof AREA_ICON_MAP;

interface Props {
  value?: string | number;
  label?: string;
  icon?: string;
  href?: string;
  area: AreaType;
  animation?: "left" | "right" | "top" | "bottom";
  showLabelOnMobile?: boolean;
  noJsValue?: string | number;
  tilt?: boolean;
  tiltMax?: number;
  tiltSpeed?: number;
  tiltPerspective?: number;
}

const {
  value = "",
  label = "",
  icon,
  href,
  area,
  animation = "bottom",
  showLabelOnMobile = true,
  noJsValue,
  tilt = true,
  tiltMax = 15,
  tiltSpeed = 400,
  tiltPerspective = 1000,
} = Astro.props;

const resolvedIcon = icon || AREA_ICON_MAP[area];
const isLogo = area === "logo";
const isLink = href ? true : false;

const Tag = href ? "a" : "div";
const linkAttrs = href ? { href, target: "_blank", "aria-label": label } : {};
const tiltAttrs = tilt
  ? {
      "data-tilt": "",
      "data-tilt-max": tiltMax,
      "data-tilt-speed": tiltSpeed,
      "data-tilt-perspective": tiltPerspective,
    }
  : {};
---

<Tag
  class:list={[
    {
      logo: "gs-logo",
      gh: "gs-gh",
      stars: "gs-stars",
      followers: "gs-followers",
      commits: "gs-commits",
      issues: "gs-issues",
      link: "gs-link",
      pr: "gs-pr",
      repos: "gs-repos",
    }[area],
    AREA_CLASSES[area],
    "relative flex flex-col items-center justify-center overflow-hidden rounded-lg p-4 text-center transition-all duration-700",
    animation &&
      {
        left: "_aos-left",
        right: "_aos-right",
        top: "_aos-top",
        bottom: "_aos-bottom",
      }[animation],
  ]}
  {...linkAttrs}
  {...tiltAttrs}
>
  <span class="gs-ripple"></span>

  {
    isLogo ? (
      <div class="z-10">
        <slot />
      </div>
    ) : isLink ? (
      <div class="z-10">
        <Icon
          name={AREA_ICON_MAP["link"]}
          class="absolute top-2 right-2 z-10 h-6 w-6"
        />
        {resolvedIcon && <Icon name={resolvedIcon} size="xl" />}
        <slot />
      </div>
    ) : (
      <div class="z-10 flex flex-col items-center">
        {noJsValue && (
          <span class="count no-js mb-2 text-3xl leading-none font-medium">
            {noJsValue}
          </span>
        )}
        {value && (
          <span
            class="count mb-2 text-3xl leading-none font-medium"
            data-target={value}
          >
            {value}
          </span>
        )}
        {label && (
          <label class="flex items-center justify-center gap-1 text-base font-medium">
            {resolvedIcon && <Icon name={resolvedIcon} />}
            <span class:list={[!showLabelOnMobile && "_d-md-only"]}>
              {label}
            </span>
          </label>
        )}
      </div>
    )
  }
</Tag>
